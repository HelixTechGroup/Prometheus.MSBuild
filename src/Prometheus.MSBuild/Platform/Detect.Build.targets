<Project InitialTargets="DetectPlatform">
  <PropertyGroup>
    <Array>$(TargetPlatform.Split(`-`))</Array>
    <RuntimeId>$(TargetPlatform.Split(`-`)[0])</RuntimeId>
    <PlatformId Condition="$(Array.Contains(`;`))">$(TargetPlatform.Split(`-`)[1])</PlatformId>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(TargetPlatform)' != '' ">
    <HasWindows>$(PlatformId.Contains(`windows`))</HasWindows>
    <HasAndroid>$(PlatformId.Contains(`android`))</HasAndroid>
    <HasLinux>$(PlatformId.Contains(`linux`))</HasLinux>
    <HasXamarin>$(RuntimeId.Contains(`xamarin`))</HasXamarin>
  </PropertyGroup>

  <PropertyGroup>
    <PlatformPropsPath>$(PrometheusPlatformDirectory)\$(PlatformId)\Platform.Build.Props</PlatformPropsPath>
    <PlatformTargetsPath>$(PrometheusPlatformDirectory)\$(PlatformId)\Platform.Build.Targets</PlatformTargetsPath>
  </PropertyGroup>

  <Import Project="$(PlatformPropsPath)" />

  <Target Name="DetectPlatform">
    <Message Text="| $(SectionString)" Importance="high" />
    <Message Text="| []==~ $(MSBuildThisFile) ~==[]" Importance="high" />
    <Message Text="| $(HeaderString)" Importance="high" />

    <PropertyGroup Condition="'$(TargetPlatform)' == '' And '$(TargetPlatforms)' != ''">
      <TargetPlatform>%(TPlatforms.Identity)</TargetPlatform>
    </PropertyGroup>

    <ItemGroup Condition="'$(TargetPlatforms)' != ''">
      <TPlatforms Include="$(TargetPlatforms.Split(`;`))" />
    </ItemGroup>

    <DetectPlatformTask TargetPlatform="$(TargetPlatform)" SectionSymbol="$(SectionSymbol)" Condition="'$(PrometheusTasksEnabled)' == 'true'">
      <Output TaskParameter="RuntimeId" PropertyName="RuntimeId" />
      <Output TaskParameter="PlatformId" PropertyName="PlatformId" />
    </DetectPlatformTask>

    <PropertyGroup Condition=" '$(TargetPlatform)' != '' ">
      <HasWindows>$(PlatformId.Contains(`windows`))</HasWindows>
      <HasAndroid>$(PlatformId.Contains(`android`))</HasAndroid>
      <HasLinux>$(PlatformId.Contains(`linux`))</HasLinux>
      <HasXamarin>$(RuntimeId.Contains(`xamarin`))</HasXamarin>
    </PropertyGroup>

    <CallTarget Targets="$(PlatformId)" Condition="Exists('$(PlatformPropsPath)')" />
  </Target>
</Project>